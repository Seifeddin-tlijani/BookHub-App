<div class="borrow-management-container">
  <!-- Header -->
  <div class="header">
    <h1>Mes Emprunts</h1>
    <div class="tabs">
      <button 
        [class.active]="activeTab === 'current'"
        (click)="activeTab = 'current'">
        Emprunts en cours
      </button>
      <button 
        [class.active]="activeTab === 'history'"
        (click)="activeTab = 'history'">
        Historique
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
  </div>

  <!-- Error State -->
  <div class="alert alert-danger" *ngIf="error">
    {{ error }}
  </div>

  <!-- Current Borrows -->
  <div class="borrows-list" *ngIf="activeTab === 'current' && !loading">
    <div class="borrow-card" *ngFor="let borrow of filterBorrows('current')">
      <div class="book-info">
        <img [src]="borrow.book?.imageUrl || 'assets/images/default-book.png'" 
             [alt]="borrow.book?.title"
             class="book-cover">
        <div class="book-details">
          <h3>{{ borrow.book?.title }}</h3>
          <p class="author">{{ borrow.book?.author }}</p>
          <div class="borrow-dates">
            <span class="date-label">Emprunté le:</span>
            <span class="date">{{ borrow.borrowDate | date:'dd/MM/yyyy' }}</span>
            <span class="date-label">À retourner le:</span>
            <span class="date" [class.overdue]="isOverdue(borrow.dueDate)">
              {{ borrow.dueDate | date:'dd/MM/yyyy' }}
            </span>
          </div>
          <div class="status-badge" 
               [class.overdue]="isOverdue(borrow.dueDate)"
               [class.warning]="getDaysRemaining(borrow.dueDate) <= 3">
            <i class="fas" 
               [class.fa-exclamation-circle]="isOverdue(borrow.dueDate)"
               [class.fa-clock]="!isOverdue(borrow.dueDate)">
            </i>
            <span *ngIf="isOverdue(borrow.dueDate)">
              En retard de {{ -getDaysRemaining(borrow.dueDate) }} jours
            </span>
            <span *ngIf="!isOverdue(borrow.dueDate)">
              {{ getDaysRemaining(borrow.dueDate) }} jours restants
            </span>
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="btn btn-primary" 
                (click)="returnBook(borrow.id)"
                [disabled]="loading">
          <i class="fas fa-undo-alt"></i>
          Retourner
        </button>
        <button class="btn btn-outline-primary" 
                (click)="extendBorrow(borrow.id)"
                [disabled]="loading || isOverdue(borrow.dueDate)">
          <i class="fas fa-clock"></i>
          Prolonger
        </button>
      </div>
    </div>

    <!-- Empty State for Current Borrows -->
    <div class="empty-state" *ngIf="filterBorrows('current').length === 0">
      <i class="fas fa-books fa-3x"></i>
      <h3>Aucun emprunt en cours</h3>
      <p>Vous n'avez pas de livres empruntés actuellement.</p>
    </div>
  </div>

  <!-- Borrow History -->
  <div class="borrows-list" *ngIf="activeTab === 'history' && !loading">
    <div class="borrow-card history" *ngFor="let borrow of filterBorrows('history')">
      <div class="book-info">
        <img [src]="borrow.book?.imageUrl || 'assets/images/default-book.png'" 
             [alt]="borrow.book?.title"
             class="book-cover">
        <div class="book-details">
          <h3>{{ borrow.book?.title }}</h3>
          <p class="author">{{ borrow.book?.author }}</p>
          <div class="borrow-dates">
            <span class="date-label">Emprunté le:</span>
            <span class="date">{{ borrow.borrowDate | date:'dd/MM/yyyy' }}</span>
            <span class="date-label">Retourné le:</span>
            <span class="date">{{ borrow.returnDate | date:'dd/MM/yyyy' }}</span>
          </div>
          <div class="status-badge returned">
            <i class="fas fa-check-circle"></i>
            Retourné
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State for History -->
    <div class="empty-state" *ngIf="filterBorrows('history').length === 0">
      <i class="fas fa-history fa-3x"></i>
      <h3>Aucun historique</h3>
      <p>Vous n'avez pas encore d'historique d'emprunts.</p>
    </div>
  </div>
</div>
